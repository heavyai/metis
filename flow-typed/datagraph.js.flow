// @flow
declare type Connector = {
  query: () => Promise<Array<any>>,
  tables: Array<string>
};

declare type DataState = {|
  type: "data",
  source: string | Array<SourceTransform | DataState>,
  name: string,
  transform: Array<Transform>
|};

declare type GraphContext = {
  connector: Connector,
  state: GraphState,
  parser: any,
};

declare type GraphState = {
  [string]: DataState
};

declare type Graph = {
  getState: () => GraphState,
  nodes: () => Array<DataNode>,
  data: (state: DataState) => DataNode
};

declare type DataNode = {
  getState: () => DataState,
  transform: (transform: Transform | Array<Transform> | Function) => DataNode,
  toSQL: () => string,
  values: () => Promise<Array<any>>
};


declare type TypeDefinition = {
  meta: string,
  type: string
}

declare type Parser = {
  parseExpression: Function,
  parseTransform: Function,
  parseDataState: Function,
  parseSource: Function,
  writeSQL: Function,
  write: Function,
  registerParser: Function
}
